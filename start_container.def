BootStrap: docker
From: ubuntu:20.04

%post
    apt-get update
    apt-get -y upgrade

    apt-get install -y wget
    apt-get install -y gzip
	apt-get install -y libslirp-dev
	apt-get install -y libpixman-1-0
	apt-get install -y libepoxy-dev
	apt-get install -y libpng-dev
	apt-get install -y zlib1g-dev
	apt-get install -y libnuma-dev
	apt-get install -y libgtk-3-dev
	apt-get install -y libnettle7
	apt-get install -y nettle-dev
	apt-get install -y gettext

	apt-get install -y fakeroot libfakeroot
    apt-get install -y build-essential
	apt-get install -y file
	apt-get install -y cpio zip unzip rsync bc
	apt-get install -y autoconf automake autotools-dev curl libmpc-dev libmpfr-dev libgmp-dev gawk build-essential bison flex texinfo gperf libtool patchutils bc zlib1g-dev libexpat-dev git
	apt-get install -y gcc-riscv64-linux-gnu
	apt-get install -y python3.8-venv meson ninja-build

%runscript
	if [ "$1" = "qemu" ]; then
		if [ "$2" = "build" ]; then
			rm -rf build
			sh configure.sh
			make -j30 -C build
			make install -j30 -C build
		elif [ "$2" = "start" ]; then
			sh start.sh
		else
			echo "Unrecognized qemu command"
			exit 1
		fi
	elif [ "$1" = "buildroot" ]; then
		if [ "$2" = "build" ]; then
			make clean
			make -j30
		else
			echo "Unrecognized buildroot command"
			exit 1
		fi
    else
        echo "Unrecognized command"
        exit 1
    fi

